<html>
<head>
<link rel="stylesheet" href="assests/foundation-4.3.2/css/foundation.css">
<link rel="stylesheet" href="SiteStyle.css">
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<title>Improv</title>


<script type="text/javascript">
$(document).ready(function () {
	//instance variables, and scale initialisations
	var $cards = $('.row p'),scales = [], notes = [], mapping = [], sorted = [], derived = [], RandomiserScales = [], duplicates = [], selectedScale, intervalsContainer = [], intervalCount = 0, selectedTone = '';
	scales['Minor'] = ['t','s','t','t','s','t','s'];
	scales['Major'] = ['t','t','s','t','t','t','s'];
	notes = ['A', 'A#','B','C','C#','D', 'D#', 'E','F','F#','G','G#'];
	RandomiserScales = ['Minor', 'Major'];
	intervalsContainer = [0,1,2,3,4,5,6];
	//set up dom elements
	InitilisePage();
	//$("#scales").change(function(e) {console.log('event hit'); $("#tone-selector-container").slideDown('slow');});
	//$("#tones").change(function(e) { console.log('event hit'); $('#interval-count-selector-container').slideDown('slow'); });
	//$("#interval-count").change(function(e) { console.log('event hit'); $('#form-controls').slideDown('slow'); });
	
	//add event listerner
	$('#submit').click(function(){
		$( "#deck" ).empty();
		intervalsContainer = [0,1,2,3,4,5,6];
		selectedScale = $('#scales option:selected').val();
		selectedTone = $('#tones option:selected').val();
		intervalCount = $('#interval-count option:selected').val() 

		if(selectedScale == 'Random' || intervalCount == 'Random' || selectedTone == 'Random'){
			LessSuperRandom(selectedScale, intervalCount, selectedTone);
			console.log('one of you is random');
		}
		else{
		SortNotes(selectedTone);
		console.log('Interval count is: ' + intervalCount);
		DeriveScale(selectedScale);
		UpdateCards();}
	});

	$('#super-random').click(function(){
		SuperRandom();
	});


	//return random intervals from derived scale
	function GetIntervals(){
		var random = Math.floor(Math.random() * intervalsContainer.length); 
		var displayValue =  (intervalsContainer[random] +  ' ' + derived[intervalsContainer[random]]) +'';
		intervalsContainer.splice(random,1);
		console.log('r ' + random + 'dis ' + displayValue);
		return displayValue + '';
	}
	//sort notes acording to selected tone
	function SortNotes(tone){
		var tonePosistion = 0;
		for(var i = 0; i < notes.length; i++){
			if(notes[i] == tone){
				tonePosistion = i;
			}
		}
		for(var i = 0; i < notes.length; i++){
				if(tonePosistion >= notes.length){tonePosistion=0;}
				sorted[i] = notes[tonePosistion];
				tonePosistion++;
		}
		console.log(sorted + 'sorted');
	}
	//create the scale for selected tone
	function DeriveScale(scale){
		var pointer  = 0;
		for(var i = 0; i < scales[scale].length; i++){
			if(scales[scale][i] == 't'){
				derived[i] = sorted[pointer];
				pointer ++;
				console.log('tone' + i);
			}
			else if(scales[scale][i] == 's'){
				derived[i] = sorted[pointer];
				console.log('semi tone' + i);
			}
			pointer++;
		}
		console.log(derived + ' derived');
	}
	//update UI components 
	function UpdateCards(){
			var unfilteredIntervals = GetIntervals();
			var intervalCorrection = 0;
			console.log('count from update cards ' + intervalCount);
			var columSize = 12  / intervalCount; 
		for(var i = 0; i < intervalCount; i++){
				var resultData = GetIntervals().split(" ")
				if(resultData[0] == '0'){
					intervalCorrection = 'Root';
				}
				else{
					intervalCorrection = parseInt(resultData[0])+1;
				}
				console.log(resultData);

				var card = '<div class="col-md-'+ columSize + '"><div class="panel"><div><h3 class="form-controls"> Your note is: </h3><h1 class="form-controls">'+ resultData[1] + '</h1><h3 class="form-controls">Your interval is: </h3><h1 class="form-controls">' + intervalCorrection + '</h1></div></div></div>';
				
				var cardContent ='<div><h3 class="form-controls"> Your note is: </h3><h1 class="form-controls">'+ resultData[1] + '</h1><h3 class="form-controls">Your interval is: </h3><h1 class="form-controls">' + intervalCorrection + '</h1></div>';

				$('#deck').append(card);
		}	
			$('#cards-container').fadeIn( "slow" );
	}
	//initise dropdowns
	function InitilisePage(){
		for(var i = 0; i  < notes.length; i++){
			$('<option />', {value: notes[i], text: notes[i]}).appendTo('#tones');
		}
		for(var scale in scales){
			$('<option />', {value: scale, text: scale}).appendTo('#scales');
		}
	}
	//select super random functionallity
	function SuperRandom(){
		$( "#deck" ).empty();
		intervalsContainer = [0,1,2,3,4,5,6];
		var randomTone = GetRandom(11);
		SortNotes(notes[randomTone]);
		intervalCount = GetRandom(5);
		var randomScale = RandomiserScales[GetRandom(2)];
		DeriveScale(randomScale);
		UpdateCards();
		var randomiserData = '<h3> You Scale is: ' + randomScale + '</h3><h3>Your Tone is: ' + notes[randomTone] + '</h3>';
		$('#info-panel').html(randomiserData);
	}

	function UpdateInfoPannel(scale, tone){

		var randomiserData = '<h3> You Scale is: ' + scale + '</h3><h3>Your Tone is: ' + tone + '</h3>';
		$('#info-panel').html(randomiserData);
	}

	function LessSuperRandom(selectedScale, Count, Tone){
		console.log('Tone IS !!!' + Tone);
		if(Tone == 'Random'){

			Tone = notes[GetRandom(11)];
			SortNotes(Tone);
		}else{SortNotes(Tone)}
		if(selectedScale == 'Random'){
				selectedScale = RandomiserScales[GetRandom(2)];
				DeriveScale(selectedScale);
		}else{
			DeriveScale(selectedScale);
		}if(Count == 'Random'){
			intervalCount = GetRandom(5);
			console.log('Random interval count is: ' + intervalCount);
		}
		else{intervalCount = intervalCount;}
		UpdateInfoPannel(selectedScale, Tone);
		UpdateCards();
		console.log(selectedScale + intervalCount + ' ' + selectedTone);
	}

	function GetRandom(limiter){
		return Math.floor(Math.random() * limiter);
	}


 });
</script>
</head>
<body>
	<div class="row collapse">
		<div class="small-3 large-2 columns">
      		<span class="prefix">Select Your Scale</span>
    	</div>
    	<div class="small-9 large-10 columns">
      		<select id='scales'>
				<option>Random</option>
			 </select> 
    	</div>
    </div>
    <div class="row collapse">
		<div class="small-3 large-2 columns" id="tone-selector-container">
			<span class="prefix">Get Your Tone</span>
		</div>
    	<div class="small-9 large-10 columns">
			<select id='tones'>
				<option>Random</option>
			</select> 
		</div>
	</div>
	<div class="row collapse">
		<div class="small-3 large-2 columns" id="interval-count-selector-container">
			<span class="prefix">Select Those Intervals</span>
    	</div>
    	<div class="small-9 large-10 columns">
			<select id='interval-count'>
				<option>Random</option>
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>s
			</select> 
		</div>
	</div>
	<div class="row">
		<div class="large-centered columns">
			<button type-'button' id='submit'>Get Those Intervals</button>
			<button type-'button' id='super-random'>Go Super Random</button>
		</div>
	</div>
	<div class="row">
		<div class="large-12 large-centered columns">
		<div class="panel" id='info-panel'></div>
	</div>
		</div>
	</div>
	<div id="cards-container">
	<div class="row" id='deck'>
	</div>
	</div>

	<div class="row">
	<div class="small-4 large-4 columns">
			<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
			<input type="hidden" name="cmd" value="_s-xclick">
			<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
			">
			<input type="image" src="https://www.paypalobjects.com/en_US/GB/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal – The safer, easier way to pay online.">
			<img alt="" border="0" src="https://www.paypalobjects.com/en_GB/i/scr/pixel.gif" width="1" height="1">
			</form>
	</div>
	
	<div class="small-4 large-4 columns">
			<a href="#" 
			  onclick="
			    window.open(
			      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href), 
			      'facebook-share-dialog', 
			      'width=626,height=436'); 
			    return false;"><img class="socail-icon"  src='images/icon-social-facebook.svg'/>
			</a>

			<a href="https://twitter.com/share" data-via="AsaCarrington"><img class="socail-icon" src="images/icon-social-twitter.svg"/></a>
			<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
			</script>
			<img src="images/icon-social-github.svg" class="socail-icon"/>
	</div>
	</div>
</body>
</html>